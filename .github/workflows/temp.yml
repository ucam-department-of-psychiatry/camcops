---
name: Temp

on:
    push:
        paths:
          - .github/workflows/temp.yml

jobs:
    temp:
        runs-on: ubuntu-22.04
        steps:
            - uses: actions/checkout@v4
            - name: Write file
              run: |
                  set -euo pipefail
                  echo "Testing..." > /tmp/test.txt
            - name: Work out commit
              # TODO: This seems to be ignored and instead the release gets
              # called uncommitged-<some hash>
              id: vars
              run: |
                  set -euo pipefail
                  QT_VERSION="$(sed 's/[a-z-]//g' ${GITHUB_WORKSPACE}/tablet_qt/qt_version.txt)"
                  echo "commit=${GITHUB_SHA}" >> $GITHUB_OUTPUT
                  echo "tag=qt_${QT_VERSION}_${GITHUB_SHA}" >> $GITHUB_OUTPUT
            - name: Release
              uses: ncipollo/release-action@v1
              with:
                  artifacts: "/tmp/test.txt"
                  token: ${{ secrets.GITHUB_TOKEN }}
                  prerelease: true
                  draft: true
                  body: Testing draft release (${{ steps.vars.outputs.tag }})
                  name: Test, please ignore (${{ steps.vars.outputs.tag }})
                  commit: ${{ steps.vars.outputs.commit }}
                  tag: ${{ steps.vars.outputs.tag }}
